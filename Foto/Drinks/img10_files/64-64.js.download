(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{515:function(e,t,i){"use strict";i.r(t);var n=i(1),s=i.n(n),o=i(5),a=i.n(o),r=i(2),c=i.n(r),h=i(4),u=i(789),d=i(74),g=i(790),l=(i(931),i(786));function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(e){return e.find(".owl-item:not(.cloned)>.component").get().map((function(e){return s()(e).attr("data-cms-id")}))},w=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$ugcReviews=t,this.config=i,this.$ugcReviewContainer=t.find(".js-container.reviews-content"),this.$ugcPhotoContainer=t.find(".js-container.photos-content"),this.$ugcReviewIndex=t.find(".review-index"),this.$ugcContainer=this.$ugcReviewContainer,this.$ugcReviewsContent=t.find(".reviews-content"),this.$ugcPhotosContent=t.find(".photos-content"),this.$ugcPrevButton=t.find(".ugc-review-prev"),this.$ugcNextButton=t.find(".ugc-review-next"),this.recipeId=t.data("id"),this.headline=t.data("headline"),this.legacyId=t.data("legacy-cms-id"),this.author=t.data("author"),this.reviewsCount=t.data("reviews-count")||0,this.photosCount=t.data("photos-count")||0,this.recipePage=t.data("page")||0,this.reviewsPage=1,this.reviewsReqt=!1,this.photosPage=1,this.photosReqt=!1,this.onClick=this.onClick.bind(this),this.onChange=this.onChange.bind(this),this.onReviewsUpdated=this.onReviewsUpdated.bind(this),this.settings=t.data(),this.trackingType=c.a.get(i,"tracking.type",{}),this.trackingData=c.a.get(i,"tracking.data",{}),this.options=c.a.defaults(this.settings,c.a.get(i,"carousel",{})),this.$ugcModal=n}var t,i,n;return t=e,(i=[{key:"getReviews",value:function(){var e,t,i=this;if(0===this.recipePage&&(e=this.reviewsIds,t=this.$ugcReviewContainer,e.indexOf(function(e){return e.find(".owl-item.active>.component").attr("data-cms-id")}(t))>=this.reviewsIds.length-4&&!this.reviewsReqt)){var n=s()(".ugc-reviews .sort-option.active").data("sort")||null,o={id:this.recipeId,reviews_count:this.reviewsCount,page:this.reviewsPage,sort:n};this.reviewsReqt=!0,s.a.get(this.config.api.endpoints.reviews,o,(function(e){i.renderReviews(e.reviews),i.reviewsIds=p(i.$ugcReviewContainer),i.reviewsReqt=!1,i.reviewsPage+=1}))}}},{key:"getPhotos",value:function(){var e=this,t=this.getIndex(),i=t.index;if(t.isLast&&this.photosReqt&&this.$ugcNextButton.addClass("disabled"),i>=this.photosIds.length-4&&!this.photosReqt){var n={id:this.recipeId,photo_count:this.photosCount,page:this.photosPage,legacy_cms_id:this.legacyId};this.photosReqt=!0,s.a.get(this.config.api.endpoints.images,n,(function(t){e.renderPhotos(t.images),e.photosIds=p(e.$ugcPhotoContainer),e.photosReqt=!1,e.photosPage+=1,e.$ugcNextButton.removeClass("disabled")}))}}},{key:"renderReviews",value:function(e,t){var i=this;if(e){if(t){var n=e.join();this.$ugcReviewContainer.trigger("replace.owl.carousel",n),this.$ugcReviewContainer.trigger("refresh.owl.carousel"),this.reviewsPage=1,this.goToReview()}else e.forEach((function(e){return i.$ugcReviewContainer.trigger("add.owl.carousel",e)})),this.$ugcReviewContainer.trigger("refresh.owl.carousel");this.reviewsIds=p(this.$ugcReviewContainer)}}},{key:"renderPhotos",value:function(e){var t=this;e&&(e.forEach((function(e){return t.$ugcPhotoContainer.trigger("add.owl.carousel",e)})),this.$ugcPhotoContainer.trigger("refresh.owl.carousel"))}},{key:"showReviews",value:function(){this.trackingType="reviews",this.$ugcReviewsContent.show(),this.$ugcPhotosContent.hide(),this.$ugcReviews.find(".component.recipe-reviews-sort").show()}},{key:"showPhotos",value:function(){this.trackingType="photos",this.$ugcReviewsContent.hide(),this.$ugcPhotosContent.show(),this.$ugcReviews.find(".component.recipe-reviews-sort").hide()}},{key:"goToReview",value:function(e){this.showReviews(),this.$ugcContainer=this.$ugcReviewContainer;var t=e?this.getIndex(e).index:0;this.$ugcContainer.trigger("to.owl.carousel",[t,0,!0]),this.updateIndex(),this.segmentPage(e)}},{key:"goToPhoto",value:function(e){this.showPhotos(),this.$ugcContainer=this.$ugcPhotoContainer;var t=this.getIndex(e).index;this.$ugcContainer.trigger("to.owl.carousel",[t,0,!0]),this.updateIndex(),this.segmentPage(e)}},{key:"getIndex",value:function(e){var t=this.$ugcContainer.find(".owl-item:not(.cloned)>.component"),i=this.$ugcContainer.find(".owl-item.active>.component"),n=e?t.get().findIndex((function(t){return e===t.dataset.cmsId})):t.get().indexOf(i.get(0));return{index:n<0?0:n,isLast:n===t.length-1,itemCount:t.length}}},{key:"handleEvents",value:function(){a()(h.n).subscribe(this.onClick),a()(h.Z).subscribe(this.onChange),a()(h.mb).subscribe(this.onReviewsUpdated),a()(h.ac).subscribe((function(e){s()(".recipe-reviewed-items").prepend(e.html)}))}},{key:"refreshModalAds",value:function(){window.karma=window.karma||{};var e=c.a.get(this,"$ugcModal.adData.slotIds",[]);window.karma.cmd.push((function(){window.karma.refresh(e)}))}},{key:"handlePrev",value:function(){return this.$ugcContainer.trigger("prev.owl.carousel"),this.refreshModalAds(),this.updateIndex()}},{key:"handleNext",value:function(){return this.$ugcContainer.trigger("next.owl.carousel"),this.refreshModalAds(),this.updateIndex()}},{key:"onClick",value:function(e,t){return Object(g.a)(t,this.$ugcPrevButton)&&!this.$ugcPrevButton.hasClass("disabled")?(this.handlePrev(),this.trackPage()):Object(g.a)(t,this.$ugcNextButton)&&!this.$ugcNextButton.hasClass("disabled")?(this.handleNext(),this.trackPage()):null}},{key:"onChange",value:function(e,t){return Object(g.a)(t,this.$ugcContainer)&&a()(h.vb).broadcast(),null}},{key:"updateIndex",value:function(){var e=this.getIndex().index;"reviews"===this.$ugcContainer.data("type")?(this.$ugcReviewIndex.text(e+1),this.togglePrevButtonDisabled(e),this.getReviews()):(this.togglePrevButtonDisabled(e),this.getPhotos())}},{key:"togglePrevButtonDisabled",value:function(e){e?this.$ugcPrevButton.removeClass("disabled"):this.$ugcPrevButton.addClass("disabled")}},{key:"onReviewsUpdated",value:function(e,t){this.renderReviews(e,t)}},{key:"trackPage",value:function(){var e=this.$ugcReviews.find(".owl-item.active .recipe-review-wrapper").data("cms-id");this.segmentPage(e)}},{key:"segmentPage",value:function(e){var t="reviews"===this.trackingType?this.trackingData.reviews:this.trackingData.photos;d.a.page({contentType:t.contentType,contentCmsId:e,linkedCmsId:this.$ugcReviews.data("id"),meredithApplication:"Front End Modal",path:"".concat(window.location.pathname).concat(t.path,"/").concat(e)})}},{key:"initializeReviewsCarousel",value:function(){this.$ugcReviewContainer.addClass("owl-carousel"),this.$ugcReviewContainer.owlCarousel(this.options)}},{key:"initializePhotosCarousel",value:function(){this.$ugcPhotoContainer.addClass("owl-carousel"),this.$ugcPhotoContainer.owlCarousel(this.options)}},{key:"init",value:function(){return this.initializeReviewsCarousel(),this.initializePhotosCarousel(),this.reviewsIds=p(this.$ugcReviewContainer),this.photosIds=p(this.$ugcPhotoContainer),this.handleEvents()}}])&&v(t.prototype,i),n&&v(t,n),e}(),f={api:{endpoints:{reviews:Object(l.a)("/element-api/content-proxy/reviews"),images:Object(l.a)("/element-api/content-proxy/images")}},carousel:{loop:!0,items:1,nav:!1,dots:!1,center:!0,lazyLoad:!0,lazyPrefetch:4,autoHeight:!0,addClassActive:!0,paginationSpeed:100,responsiveRefreshRate:100,mouseDrag:!1,touchDrag:!0,smartSpeed:200},tracking:{type:"reviews",data:{reviews:{contentType:"Reviews",path:"/reviews"},photos:{contentType:"Recipe Photos",path:"/photos"}}}};t.default=function(){var e=s()(".modal.ugc-modal"),t=new u.a(e,"ugc-modal"),i=new w(s()(".component.ugc-reviews"),f,t);return a()(h.n).subscribe((function(e,n){var o=s()(".ugc-reviews-link"),r=s()(".ugc-photos-link"),c=s()(".ugc-upload-button"),u=s()(".image-container.ugc-upload-button"),d=s()(".icon-image-zoom"),l=s()(".component.popup"),v=s()(".recipe-review-helpful");if(Object(g.a)(n,v)){if(e.preventDefault(),n.parent().closest(".recipe-review-helpful").hasClass("fired"))return!0;!function(e,t){if(s()("body").hasClass("authenticated")){var i=e,n={id:s()("body").data("content-graph-id"),reviewId:i,type:"post"};s.a.ajax({url:"/element-api/content-proxy/helpful",type:"POST",data:n,cache:!1,success:function(e,i,n){if(200===n.status&&!t.parent().closest(".review-helpful-active").hasClass("fired")){t.parent().closest(".review-helpful-active").addClass("fired");var s=t.parent().find(".helpful-count").html();s=s&&""!==s?parseInt(s,10)+1:1,t.parent().find(".helpful-count").html(s)}}})}else{var o=s()(".component.recipe-ingredients-new").data("login-url");o="".concat(o),window.open(o)}}(n.closest(".component.ugc-review").attr("data-cms-id"),n)}if(Object(g.a)(n,o)){e.preventDefault(),t.adData.targeting.type="reviews",t.open();var p=s()(".recipe-reviewed-items").prev().find(".sort-option.active").index();s()(".component.ugc-reviews").find(".sort-options a:eq(".concat(p,")")).trigger("click"),setTimeout((function(){var e=n.closest(".component.ugc-review").attr("data-cms-id");i.goToReview(e)}),200)}if(Object(g.a)(n,r)&&!Object(g.a)(n,d)&&!Object(g.a)(n,l)){var w=n.find(".recipe-play-button a");if(w.length)window.location=w.attr("href");else if(0!==s()(".image-filmstrip").length&&0!==s()(".image-filmstrip").find(".image-slide").length){e.preventDefault(),t.adData.targeting.type="photos",t.open();var f=n.closest(".ugc-photos-link").attr("data-cms-id")||n.closest(".component.ugc-review").attr("data-cms-id");i.goToPhoto(f)}}return Object(g.a)(n,c)&&a()(h.ec).broadcast(e,n),Object(g.a)(n,u)&&a()(h.ec).broadcast(e,n),null})),i.init()}},786:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(2),s=i.n(n),o=i(1),a=i.n(o);function r(e){return a()(document.body).data("add-slash")&&!s.a.endsWith(e,"/")?"".concat(e,"/"):e}}}]);
//# sourceMappingURL=64-64.js.map